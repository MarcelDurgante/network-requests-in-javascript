<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <link rel="icon" href="img/favicon.ico" />
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="css/styles.css">
    <script src="js/helpers.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Globoticket</title>
</head>

<body>
    <div id="root">
        <nav class="navbar navbar-expand navbar-dark fixed-top bg-dark">
            <div class="container-fluid">
                <div class="collapse navbar-collapse">
                    <ul class="navbar-nav me-auto ms-3 mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a href="./" class="navbar-brand"><img src="img/logo.png" alt="Globoticket logo" /></a>
                        </li>
                    </ul>
                </div>
                <div class="collapse navbar-collapse">
                    <ul class="navbar-nav ms-auto me-5 mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a href="./cart" class="nav-link">
                                <span class="bi bi-cart-plus-fill text-white font-xxlarge"></span>
                                <span class="font-upper font-bold text-white ms-4">
                                    <span class="font-xxlarge align-middle" id="spanTickets">0</span>
                                    <span class="align-middle ms-2">ticket(s)</span>
                                </span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <div class="container" id="eventtable">
            <div class="container">
                <table class="table mt-5">
                    <thead>
                        <tr>
                            <th scope="col"></th>
                            <th scope="col">Date</th>
                            <th scope="col">Name</th>
                            <th scope="col">Artist</th>
                            <th scope="col">Price</th>
                            <th scope="col"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="align-middle">
                            <td>
                                <img class="img-fluid max-100" src="img/logos/Container-Enthusiasm-TalkDocker-To-Me.png"
                                    alt="Cover" />
                            </td>
                            <td class="max-50">
                                10/1/2025, 7:00:00 PM
                            </td>
                            <td class="max-50">
                                Talk Docker to Me Tour
                            </td>
                            <td class="max-50">
                                Container Enthusiasm
                            </td>
                            <td class="max-50">
                                $49.99
                            </td>
                            <td class="max-50">
                                <button type="button" class="btn btn-primary btn-primary-themed btn-md font-upper"
                                    onclick="document.getElementById('spanTickets').innerHTML = ++(document.getElementById('spanTickets').innerHTML)">Add
                                    to Cart</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <script>
        /* Error handling: 
        
        Let's see three different error scenarios that could occur. 
        
            - The first is that fetch is throwing an error. So, running the fetch call generates an exception. And I think we all know what should be done here. We put the fetch call in a try catch block, and then we can properly handle the error, and then, for instance, display an error message. 
            
            - However, it could also be that the call itself works, but there is an error on the server, so a client error or a server error of 404 or an HTTP 500. And all of those error HTTP status codes will not lead to a client‑side exception because the call was made, and the call was properly answered. It wasn't answered with data. It was answered with an error information, but still there was a response to the HTTP request, and that's why we have to look at the status code and then handle the error because fetch won't throw any. 
            
            - And there's a third option that's often forgotten. It's that the data we get back could be malformed. So we could expect JSON, but we see something that is not valid JSON. So the conversion throws an error. Of course, that means our call to response.json, for instance, needs to be put in a try catch block as well. 
        
        */
        // The API has another secret endpoint. It's api/events‑brittle because that endpoint returns an HTTP 500 response 1 out of 4 times. 
        fetch('api/events-brittle')
            // So things could go wrong, and therefore, we can just show those events or jsonify the response. 
            // Instead, we just go in there. And then before we return response.json, we check the status, and if it's !==200.
            .then(response => {
                if (response.status !== 200) {
                    // I've already prepared a helper function, showError, and then we can just say Something went wrong. And that just displays that information.
                    showError('Something went wrong!')
                }
                return response.json();
            })
            .then(events => showEvents(events));

            /* output after re-loading the page 3 times: 
            
            GET http://localhost:3000/api/events-brittle 500 (Internal Server Error)                       (index):98 

            Uncaught (in promise) TypeError: events.forEach is not a function                            helpers.js:3 
                at showEvents (helpers.js:3:12)
                at (index):108:29
            
            */

        function addToCart(id, quantity) {
            fetch('api/cart', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ id: id, quantity: quantity })
            })
                .then(response => {
                    if (response.status === 200) {
                        fetch('api/cart')
                            .then(response => response.json())
                            .then(cart => updateCart(cart));
                    }
                })
        };
    </script>
</body>

</html>